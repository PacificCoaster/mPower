<pre class="code">
<span class="srcline"><span class="lineno"><a href="112,1" id="srcline1"> 1</a></span><span class="line"><span class="comment">% Computes basic gait test features.</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Inputs:</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%  gait - gait accelerometry vector: gait(:,1) - time points,</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%         gait(:,2:4) - X,Y,Z acceleration data</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% (CC BY-SA 3.0) Max Little, 2014</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,7" id="srcline7"> 7</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T56U3">ft</span> = features_bga(<span class="var type1" id="S3T41U6">gait</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="112,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">% Output feature vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,10" id="srcline10">10</a></span><span class="line"><span class="mxinfo " id="T56:U3"><span class="var type1" id="S2T56U9">ft</span> = <span class="mxinfo " id="T56:U5">NaN(<span class="mxinfo " id="T1:U6">1</span>,<span class="mxinfo " id="T1:U7">7</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,12" id="srcline12">12</a></span><span class="line"><span class="comment">% Ignore zero-length inputs</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T1:U8"><span class="var type1" id="S5T1U16">N</span> = <span class="mxinfo " id="T1:U10">size(<span class="var type1" id="S3T41U19">gait</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,14" id="srcline14">14</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T2:U12"><span class="var type1" id="S5T1U25">N</span> == <span class="mxinfo " id="T1:U14">0</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="112,15" id="srcline15">15</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,16" id="srcline16">16</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,18" id="srcline18">18</a></span><span class="line"><span class="comment">% Calculate relative time</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T3:U15"><span class="var type1" id="S7T3U30">t</span> = <span class="mxinfo " id="T3:U17"><span class="mxinfo " id="T3:U18"><span class="var type1" id="S3T41U33">gait</span>(:,<span class="mxinfo " id="T1:U20">1</span>)</span>-<span class="mxinfo " id="T1:U21"><span class="var type1" id="S3T41U37">gait</span>(<span class="mxinfo " id="T1:U23">1</span>,<span class="mxinfo " id="T1:U24">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,20" id="srcline20">20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo " id="T1:U25"><span class="var type1" id="S8T1U42">Tstart</span> = <span class="mxinfo " id="T1:U27">3.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo " id="T1:U28"><span class="var type1" id="S9T1U46">Tend</span>   = <span class="mxinfo " id="T1:U30">19.0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,24" id="srcline24">24</a></span><span class="line"><span class="comment">% Ignore gait tests which do not contain enough data</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,25" id="srcline25">25</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T2:U31"><span class="mxinfo " id="T1:U32">max(<span class="var type1" id="S7T3U54">t</span>)</span> &lt; <span class="mxinfo " id="T1:U34"><span class="var type1" id="S9T1U55">Tend</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="112,26" id="srcline26">26</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,27" id="srcline27">27</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,29" id="srcline29">29</a></span><span class="line"><span class="comment">% Trim away start/end of test</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,30" id="srcline30">30</a></span><span class="line"><span class="mxinfo " id="T115:U36"><span class="var type1" id="S11T115U59">istart</span> = <span class="mxinfo " id="T115:U38">find(<span class="mxinfo " id="T42:U39"><span class="var type1" id="S7T3U63">t</span> &gt;= <span class="mxinfo " id="T1:U41"><span class="var type1" id="S8T1U64">Tstart</span></span></span>,1,<span class="string">'first'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo " id="T115:U43"><span class="var type1" id="S13T115U69">iend</span>   = <span class="mxinfo " id="T115:U45">find(<span class="mxinfo " id="T42:U46"><span class="var type1" id="S7T3U73">t</span> &lt;= <span class="mxinfo " id="T1:U48"><span class="var type1" id="S9T1U74">Tend</span></span></span>,1,<span class="string">'last'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T48:U50"><span class="var type1" id="S14T48U79">gaittrim</span> = <span class="mxinfo " id="T48:U52"><span class="var type1" id="S3T41U81">gait</span>(<span class="mxinfo " id="T2:U54"><span class="mxinfo " id="T1:U55"><span class="var type1" id="S11T115U84">istart</span>(<span class="mxinfo " id="T1:U57">1</span>)</span>:<span class="mxinfo " id="T1:U58"><span class="var type1" id="S13T115U87">iend</span>(<span class="mxinfo " id="T1:U60">1</span>)</span></span>,<span class="mxinfo " id="T49:U61"><span class="mxinfo " id="T1:U62">2</span>:<span class="mxinfo " id="T1:U63">4</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo " id="T3:U64"><span class="var type1" id="S15T3U94">ttrim</span> = <span class="mxinfo " id="T3:U66"><span class="var type1" id="S7T3U96">t</span>(<span class="mxinfo " id="T1:U68"><span class="var type1" id="S11T115U99">istart</span>(<span class="mxinfo " id="T1:U70">1</span>)</span>:<span class="mxinfo " id="T1:U71"><span class="var type1" id="S13T115U102">iend</span>(<span class="mxinfo " id="T1:U73">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo " id="T1:U74"><span class="var type1" id="S5T1U106">N</span> = <span class="mxinfo " id="T1:U76">length(<span class="var type1" id="S14T48U109">gaittrim</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo " id="T1:U78"><span class="var type1" id="S17T1U112">T</span> = <span class="mxinfo " id="T1:U80"><span class="var type1" id="S15T3U114">ttrim</span>(<span class="mxinfo " id="T1:U82">end</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo " id="T1:U83"><span class="var type1" id="S19T1U119">dT</span> = <span class="mxinfo " id="T1:U85"><span class="var type1" id="S17T1U121">T</span>-<span class="mxinfo " id="T1:U87"><span class="var type1" id="S15T3U123">ttrim</span>(<span class="mxinfo " id="T1:U89">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,39" id="srcline39">39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,40" id="srcline40">40</a></span><span class="line"><span class="comment">% Orientation</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo " id="T49:U90"><span class="var type1" id="S20T49U127">mg</span> = <span class="mxinfo " id="T49:U92">mean(<span class="var type1" id="S14T48U130">gaittrim</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,42" id="srcline42">42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,43" id="srcline43">43</a></span><span class="line"><span class="comment">% Orientation-corrected force signals</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,44" id="srcline44">44</a></span><span class="line"><span class="mxinfo " id="T48:U94"><span class="var type1" id="S22T48U133">gaitforce</span> = <span class="mxinfo " id="T48:U96"><span class="var type1" id="S14T48U135">gaittrim</span>-<span class="mxinfo " id="T48:U98">repmat(<span class="var type1" id="S20T49U138">mg</span>,<span class="var type1" id="S5T1U139">N</span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,45" id="srcline45">45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,46" id="srcline46">46</a></span><span class="line"><span class="comment">% Scaled velocity signals</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,47" id="srcline47">47</a></span><span class="line"><span class="mxinfo " id="T3:U101"><span class="var type1" id="S24T3U143">dt</span> = <span class="mxinfo " id="T3:U103">diff(<span class="var type1" id="S15T3U146">ttrim</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,48" id="srcline48">48</a></span><span class="line"><span class="comment">%dt(end+1) = dt(end); -- causes code gen bug (doesn't update size of dt)</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,49" id="srcline49">49</a></span><span class="line"><span class="mxinfo " id="T3:U105"><span class="var type1" id="S24T3U149">dt</span> = <span class="mxinfo " id="T3:U107">[<span class="var type1" id="S24T3U152">dt</span>; <span class="mxinfo " id="T1:U109"><span class="var type1" id="S24T3U155">dt</span>(<span class="mxinfo " id="T1:U111">end</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,50" id="srcline50">50</a></span><span class="line"><span class="mxinfo " id="T48:U112"><span class="var type1" id="S26T48U160">gaitvel</span> = <span class="mxinfo " id="T48:U114">cumsum(<span class="mxinfo " id="T48:U115"><span class="var type1" id="S22T48U164">gaitforce</span>.*<span class="mxinfo " id="T48:U117">repmat(<span class="var type1" id="S24T3U167">dt</span>,1,3)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,51" id="srcline51">51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,52" id="srcline52">52</a></span><span class="line"><span class="comment">% Average scaled power X,Y,Z</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,53" id="srcline53">53</a></span><span class="line"><span class="mxinfo " id="T1:U119"><span class="var type1" id="S28T1U172">gaitpower</span> = <span class="mxinfo " id="T1:U121"><span class="mxinfo " id="T1:U122">mean(<span class="mxinfo " id="T49:U123"><span class="mxinfo " id="T49:U124">sum(<span class="mxinfo " id="T48:U125"><span class="mxinfo " id="T1:U126">0.5*70</span>*<span class="mxinfo " id="T48:U127"><span class="var type1" id="S26T48U184">gaitvel</span>.^2</span></span>)</span>/<span class="var type1" id="S19T1U186">dT</span></span>)</span>/<span class="mxinfo " id="T1:U130">1e4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,54" id="srcline54">54</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,55" id="srcline55">55</a></span><span class="line"><span class="comment">% Force vector magnitude signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,56" id="srcline56">56</a></span><span class="line"><span class="mxinfo " id="T3:U131"><span class="var type1" id="S30T3U190">gaitmag</span> = <span class="mxinfo " id="T3:U133">sqrt(<span class="mxinfo " id="T3:U134">sum(<span class="mxinfo " id="T48:U135"><span class="var type1" id="S22T48U196">gaitforce</span>.^2</span>,2)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,57" id="srcline57">57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,58" id="srcline58">58</a></span><span class="line"><span class="comment">% Maximum force</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,59" id="srcline59">59</a></span><span class="line"><span class="mxinfo " id="T1:U137"><span class="var type1" id="S32T1U201">gaitpeak</span> = <span class="mxinfo " id="T1:U139"><span class="mxinfo " id="T1:U140">quantile(<span class="var type1" id="S30T3U205">gaitmag</span>,0.95)</span>/<span class="mxinfo " id="T1:U142">10</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,60" id="srcline60">60</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,61" id="srcline61">61</a></span><span class="line"><span class="comment">% Zero crossing events</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,62" id="srcline62">62</a></span><span class="line"><span class="mxinfo " id="T1:U143"><span class="var type1" id="S20T1U210">mg</span> = <span class="mxinfo " id="T1:U145">mean(<span class="var type1" id="S30T3U213">gaitmag</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,63" id="srcline63">63</a></span><span class="line"><span class="mxinfo " id="T42:U147"><span class="var type1" id="S34T42U216">izc</span> = <span class="mxinfo " id="T42:U149">(<span class="mxinfo " id="T42:U150"><span class="mxinfo " id="T3:U151"><span class="var type1" id="S30T3U221">gaitmag</span>(<span class="mxinfo " id="T1:U153">1</span>:<span class="mxinfo " id="T1:U154"><span class="mxinfo " id="T1:U155">end</span>-<span class="mxinfo " id="T1:U156">1</span></span>)</span> &lt; <span class="var type1" id="S20T1U228">mg</span></span>) &amp; (<span class="mxinfo " id="T42:U158"><span class="mxinfo " id="T3:U159"><span class="var type1" id="S30T3U232">gaitmag</span>(<span class="mxinfo " id="T1:U161">2</span>:<span class="mxinfo " id="T1:U162">end</span>)</span> &gt;= <span class="var type1" id="S20T1U237">mg</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,64" id="srcline64">64</a></span><span class="line"><span class="mxinfo " id="T3:U164"><span class="var type1" id="S35T3U240">tzc</span> = <span class="mxinfo " id="T3:U166"><span class="var type1" id="S15T3U242">ttrim</span>(<span class="var type1" id="S34T42U243">izc</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,65" id="srcline65">65</a></span><span class="line"><span class="mxinfo " id="T3:U169"><span class="var type1" id="S36T3U246">dtzc</span> = <span class="mxinfo " id="T3:U171">diff(<span class="var type1" id="S35T3U249">tzc</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,66" id="srcline66">66</a></span><span class="line"><span class="mxinfo " id="T1:U173"><span class="var type1" id="S37T1U252">zcr</span> = <span class="mxinfo " id="T1:U175">median(<span class="var type1" id="S36T3U255">dtzc</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,67" id="srcline67">67</a></span><span class="line"><span class="mxinfo " id="T1:U177"><span class="var type1" id="S39T1U258">zcv</span> = <span class="mxinfo " id="T1:U179">iqr(<span class="var type1" id="S36T3U261">dtzc</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,68" id="srcline68">68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,69" id="srcline69">69</a></span><span class="line"><span class="comment">% Non-uniform frequency features</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,70" id="srcline70">70</a></span><span class="line">[<span class="mxinfo " id="T3:U181"><span class="var type1" id="S41T3U265">F</span></span>,<span class="mxinfo " id="T3:U183"><span class="var type1" id="S42T3U266">P</span></span>,<span class="mxinfo " id="T3:U185"><span class="var type1" id="S43T3U267">prob</span></span>] = <span class="fcn" id="F577N12:B269">lomb</span>(<span class="var type1" id="S15T3U270">ttrim</span>,<span class="mxinfo " id="T3:U188"><span class="var type1" id="S30T3U272">gaitmag</span>-<span class="var type1" id="S20T1U273">mg</span></span>,4,1);</span></span>
<span class="srcline"><span class="lineno"><a href="112,71" id="srcline71">71</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,72" id="srcline72">72</a></span><span class="line"><span class="comment">% Peak frequency</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,73" id="srcline73">73</a></span><span class="line">[<span class="mxinfo " id="T1:U191"><span class="var type1" id="S45T1U279">Pmax</span></span>,<span class="mxinfo " id="T1:U193"><span class="var type1" id="S46T1U280">imax</span></span>] = max(<span class="var type1" id="S42T3U283">P</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="112,74" id="srcline74">74</a></span><span class="line"><span class="mxinfo " id="T1:U196"><span class="var type1" id="S47T1U286">F0</span> = <span class="mxinfo " id="T1:U198"><span class="var type1" id="S41T3U288">F</span>(<span class="var type1" id="S46T1U289">imax</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,75" id="srcline75">75</a></span><span class="line"><span class="mxinfo " id="T1:U201"><span class="var type1" id="S48T1U292">probF0</span> = <span class="mxinfo " id="T1:U203">-<span class="mxinfo " id="T1:U204">log10(<span class="mxinfo " id="T1:U205"><span class="var type1" id="S43T3U297">prob</span>(<span class="var type1" id="S46T1U298">imax</span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,76" id="srcline76">76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,77" id="srcline77">77</a></span><span class="line"><span class="comment">% SNR of peak frequency</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,78" id="srcline78">78</a></span><span class="line"><span class="mxinfo " id="T42:U208"><span class="var type1" id="S50T42U301">i</span> = (<span class="mxinfo " id="T42:U210"><span class="var type1" id="S41T3U304">F</span> &lt;= <span class="var type1" id="S47T1U305">F0</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,79" id="srcline79">79</a></span><span class="line"><span class="mxinfo " id="T1:U213"><span class="var type1" id="S51T1U308">mP</span> = <span class="mxinfo " id="T1:U215">median(<span class="mxinfo " id="T3:U216">log10(<span class="mxinfo " id="T3:U217"><span class="var type1" id="S42T3U314">P</span>(<span class="var type1" id="S50T42U315">i</span>)</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,80" id="srcline80">80</a></span><span class="line"><span class="mxinfo " id="T1:U220"><span class="var type1" id="S52T1U318">snrF0</span> = <span class="mxinfo " id="T1:U222"><span class="mxinfo " id="T1:U223">log10(<span class="var type1" id="S45T1U322">Pmax</span>)</span>-<span class="var type1" id="S51T1U323">mP</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="112,81" id="srcline81">81</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="112,82" id="srcline82">82</a></span><span class="line"><span class="comment">% Output gait test feature vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="112,83" id="srcline83">83</a></span><span class="line"><span class="mxinfo " id="T56:U226"><span class="var type1" id="S2T56U326">ft</span> = <span class="mxinfo " id="T56:U228">[<span class="var type1" id="S32T1U329">gaitpeak</span> <span class="var type1" id="S28T1U330">gaitpower</span> <span class="var type1" id="S37T1U331">zcr</span> <span class="var type1" id="S39T1U332">zcv</span> <span class="var type1" id="S47T1U333">F0</span> <span class="var type1" id="S52T1U334">snrF0</span> <span class="var type1" id="S48T1U335">probF0</span>]</span></span>;</span></span>
</pre>
