<pre class="code">
<span class="srcline"><span class="lineno"><a href="160,1" id="srcline1">  1</a></span><span class="line"> <span class="keyword">function</span> [<span class="var type1" id="S2T3U3">p</span>,<span class="var type1" id="S3T3U4">t</span>,<span class="var type1" id="S4T3U5">s</span>] = swipep(<span class="var type1" id="S5T3U8">x</span>,<span class="var type1" id="S6T1U9">fs</span>,<span class="var type1" id="S7T8U10">plim</span>,<span class="var type1" id="S8T1U11">dt</span>,<span class="var type1" id="S9T1U12">dlog2p</span>,<span class="var type1" id="S10T1U13">dERBs</span>,<span class="var type1" id="S11T1U14">woverlap</span>,<span class="var type1" id="S12T1U15">sTHR</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="160,2" id="srcline2">  2</a></span><span class="line"> coder.extrinsic(<span class="string">'exist'</span>,<span class="string">'warning'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="160,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% SWIPEP Pitch estimation using SWIPE'.</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%    P = SWIPEP(X,Fs,[PMIN PMAX],DT,DLOG2P,DERBS,STHR) estimates the pitch </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%    of the vector signal X every DT seconds. The sampling frequency of</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%    the signal is Fs (in Hertz). The spectrum is computed using a Hann</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%    window with an overlap WOVERLAP between 0 and 1. The spectrum is</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%    sampled uniformly in the ERB scale with a step size of DERBS ERBs. The</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%    pitch is searched within the range [PMIN PMAX] (in Hertz) with samples</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%    distributed every DLOG2P units on a base-2 logarithmic scale of Hertz. </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%    The pitch is fine-tuned using parabolic interpolation with a resolution</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%    of 1 cent. Pitch estimates with a strength lower than STHR are treated</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%    as undefined.</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%    </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%    [P,T,S] = SWIPEP(X,Fs,[PMIN PMAX],DT,DLOG2P,DERBS,WOVERLAP,STHR) </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%    returns the times T at which the pitch was estimated and the pitch </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%    strength S of every pitch estimate.</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%    P = SWIPEP(X,Fs) estimates the pitch using the default settings PMIN =</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%    30 Hz, PMAX = 5000 Hz, DT = 0.001 s, DLOG2P = 1/48 (48 steps per </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%    octave), DERBS = 0.1 ERBs, WOVERLAP = 0.5, and STHR = -Inf.</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%    P = SWIPEP(X,Fs,<span class="keyword">...</span><span class="comment">,[],...) uses the default setting for the parameter</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%    replaced with the placeholder [].</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%    REMARKS: (1) For better results, make DLOG2P and DERBS as small as </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%    possible and WOVERLAP as large as possible. However, take into account</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%    that the computational complexity of the algorithm is inversely </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%    proportional to DLOG2P, DERBS and 1-WOVERLAP, and that the  default </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%    values have been found empirically to produce good results. Consider </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%    also that the computational complexity is directly proportional to the</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%    number of octaves in the pitch search range, and therefore , it is </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%    recommendable to restrict the search range to the expected range of</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%    pitch, if any. (2) This code implements SWIPE', which uses only the</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%    first and prime harmonics of the signal. To convert it into SWIPE,</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%    which uses all the harmonics of the signal, replace the word</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%    PRIMES with a colon (it is located almost at the end of the code).</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%    However, this may not be recommendable since SWIPE' is reported to </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%    produce on average better results than SWIPE (Camacho and Harris,</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%    2008).</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%    EXAMPLE: Estimate the pitch of the signal X every 10 ms within the</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%    range 75-500 Hz using the default resolution (i.e., 48 steps per</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%    octave), sampling the spectrum every 1/20th of ERB, using a window </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%    overlap factor of 50%, and discarding samples with pitch strength </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%    lower than 0.2. Plot the pitch trace.</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%       [x,Fs] = wavread(filename);</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%       [p,t,s] = swipep(x,Fs,[75 500],0.01,[],1/20,0.5,0.2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%       plot(1000*t,p)</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%       xlabel('Time (ms)')</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%       ylabel('Pitch (Hz)')</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%    REFERENCES: Camacho, A., Harris, J.G, (2008) "A sawtooth waveform </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%    inspired pitch estimator for speech and music," J. Acoust. Soc. Am.</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%    124, 1638-1652.</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%    MAINTENANCE HISTORY:</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%    - Added line 153 to avoid division by zero in line 154 if loudness</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%      equals zero (06/23/2010).</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,60" id="srcline60"> 60</a></span><span class="line"><span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="160,61" id="srcline61"> 61</a></span><span class="line">    <span class="keyword">if</span> ~ exist( <span class="string">'plim'</span>, <span class="string">'var'</span> ) || isempty(<span class="var type0" id="S7T0U40">plim</span>), <span class="var type0" id="S7T0U43">plim</span> = [30 5000]; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,62" id="srcline62"> 62</a></span><span class="line">    <span class="keyword">if</span> ~ exist( <span class="string">'dt'</span>, <span class="string">'var'</span> ) || isempty(<span class="var type0" id="S8T0U59">dt</span>) || isnan(<span class="var type0" id="S8T0U62">dt</span>), <span class="var type0" id="S8T0U65">dt</span> = 0.001; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,63" id="srcline63"> 63</a></span><span class="line">    <span class="keyword">if</span> ~ exist( <span class="string">'dlog2p'</span>, <span class="string">'var'</span> ) || isempty(<span class="var type0" id="S9T0U78">dlog2p</span>) || isnan(<span class="var type0" id="S9T0U81">dlog2p</span>), <span class="var type0" id="S9T0U84">dlog2p</span> = 1/48; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,64" id="srcline64"> 64</a></span><span class="line">    <span class="keyword">if</span> ~ exist( <span class="string">'dERBs'</span>, <span class="string">'var'</span> ) || isempty(<span class="var type0" id="S10T0U99">dERBs</span>) || isnan(<span class="var type0" id="S10T0U102">dERBs</span>), <span class="var type0" id="S10T0U105">dERBs</span> = 0.1; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,65" id="srcline65"> 65</a></span><span class="line">    <span class="keyword">if</span> ~ exist( <span class="string">'woverlap'</span>, <span class="string">'var'</span> ) || isempty(<span class="var type0" id="S11T0U118">woverlap</span>) || isnan(<span class="var type0" id="S11T0U121">woverlap</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="160,66" id="srcline66"> 66</a></span><span class="line">        <span class="var type0" id="S11T0U124">woverlap</span> = 0.5;</span></span>
<span class="srcline"><span class="lineno"><a href="160,67" id="srcline67"> 67</a></span><span class="line">    <span class="keyword">elseif</span> <span class="var type0" id="S11T0U129">woverlap</span>&gt;1 || <span class="var type0" id="S11T0U132">woverlap</span>&lt;0</span></span>
<span class="srcline"><span class="lineno"><a href="160,68" id="srcline68"> 68</a></span><span class="line">        error(<span class="string">'Window overlap must be between 0 and 1.'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="160,69" id="srcline69"> 69</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,70" id="srcline70"> 70</a></span><span class="line">    <span class="keyword">if</span> ~ exist( <span class="string">'sTHR'</span>, <span class="string">'var'</span> ) || isempty(<span class="var type0" id="S12T0U149">sTHR</span>) || isnan(<span class="var type0" id="S12T0U152">sTHR</span>), <span class="var type0" id="S12T0U155">sTHR</span> = -Inf; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,71" id="srcline71"> 71</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,72" id="srcline72"> 72</a></span><span class="line">    <span class="keyword">if</span> isempty(<span class="var type1" id="S7T8U164">plim</span>), <span class="var type0" id="S7T0U167">plim</span> = [30 5000]; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,73" id="srcline73"> 73</a></span><span class="line">    <span class="keyword">if</span> isempty(<span class="var type1" id="S8T1U177">dt</span>) || <span class="mxinfo " id="T2:U14">isnan(<span class="var type1" id="S8T1U180">dt</span>)</span>, <span class="mxinfo " id="T1:U16"><span class="var type1" id="S8T1U183">dt</span> = <span class="mxinfo " id="T1:U18">0.001</span></span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,74" id="srcline74"> 74</a></span><span class="line">    <span class="keyword">if</span> isempty(<span class="var type1" id="S9T1U190">dlog2p</span>) || <span class="mxinfo " id="T2:U20">isnan(<span class="var type1" id="S9T1U193">dlog2p</span>)</span>, <span class="mxinfo " id="T1:U22"><span class="var type1" id="S9T1U196">dlog2p</span> = <span class="mxinfo " id="T1:U24"><span class="mxinfo " id="T1:U25">1</span>/<span class="mxinfo " id="T1:U26">48</span></span></span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,75" id="srcline75"> 75</a></span><span class="line">    <span class="keyword">if</span> isempty(<span class="var type1" id="S10T1U205">dERBs</span>) || <span class="mxinfo " id="T2:U28">isnan(<span class="var type1" id="S10T1U208">dERBs</span>)</span>, <span class="mxinfo " id="T1:U30"><span class="var type1" id="S10T1U211">dERBs</span> = <span class="mxinfo " id="T1:U32">0.1</span></span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,76" id="srcline76"> 76</a></span><span class="line">    <span class="keyword">if</span> isempty(<span class="var type1" id="S11T1U218">woverlap</span>) || <span class="mxinfo " id="T2:U34">isnan(<span class="var type1" id="S11T1U221">woverlap</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,77" id="srcline77"> 77</a></span><span class="line">        <span class="mxinfo " id="T1:U36"><span class="var type1" id="S11T1U224">woverlap</span> = <span class="mxinfo " id="T1:U38">0.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,78" id="srcline78"> 78</a></span><span class="line">    <span class="keyword">elseif</span> <span class="mxinfo " id="T2:U39"><span class="var type1" id="S11T1U229">woverlap</span>&gt;<span class="mxinfo " id="T1:U41">1</span></span> || <span class="mxinfo " id="T2:U42"><span class="var type1" id="S11T1U232">woverlap</span>&lt;<span class="mxinfo " id="T1:U44">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,79" id="srcline79"> 79</a></span><span class="line">        error(<span class="string">'Window overlap must be between 0 and 1.'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="160,80" id="srcline80"> 80</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,81" id="srcline81"> 81</a></span><span class="line">    <span class="keyword">if</span> isempty(<span class="var type1" id="S12T1U243">sTHR</span>) || <span class="mxinfo " id="T2:U46">isnan(<span class="var type1" id="S12T1U246">sTHR</span>)</span>, <span class="mxinfo " id="T1:U48"><span class="var type1" id="S12T1U249">sTHR</span> = <span class="mxinfo " id="T1:U50">-<span class="mxinfo " id="T1:U51">Inf</span></span></span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,82" id="srcline82"> 82</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,83" id="srcline83"> 83</a></span><span class="line"><span class="mxinfo " id="T3:U52"><span class="var type1" id="S3T3U255">t</span> = <span class="mxinfo " id="T3:U54"><span class="mxinfo " id="T24:U55">[ 0: <span class="var type1" id="S8T1U262">dt</span>: <span class="mxinfo " id="T1:U57"><span class="mxinfo " id="T1:U58">length(<span class="var type1" id="S5T3U266">x</span>)</span>/<span class="var type1" id="S6T1U267">fs</span></span> ]</span>'</span></span>; <span class="comment">% Times</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,84" id="srcline84"> 84</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,85" id="srcline85"> 85</a></span><span class="line"><span class="keyword">global</span> <span class="var type1" id="S20T24U269">primetable</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,86" id="srcline86"> 86</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo " id="T2:U62">isempty(<span class="var type1" id="S20T24U275">primetable</span>)</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="160,87" id="srcline87"> 87</a></span><span class="line">    <span class="mxinfo " id="T24:U64"><span class="var type1" id="S20T24U278">primetable</span> = <span class="mxinfo " id="T151:U66">[<span class="mxinfo " id="T1:U67">1</span> <span class="mxinfo " id="T133:U68">primes(10000)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,88" id="srcline88"> 88</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,89" id="srcline89"> 89</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">% Define pitch candidates</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,91" id="srcline91"> 91</a></span><span class="line"><span class="mxinfo " id="T3:U69"><span class="var type1" id="S22T3U287">log2pc</span> = <span class="mxinfo " id="T3:U71"><span class="mxinfo " id="T24:U72">[ <span class="mxinfo " id="T1:U73">log2(<span class="mxinfo " id="T1:U74"><span class="var type1" id="S7T8U296">plim</span>(<span class="mxinfo " id="T1:U76">1</span>)</span>)</span>: <span class="var type1" id="S9T1U298">dlog2p</span>: <span class="mxinfo " id="T1:U78">log2(<span class="mxinfo " id="T1:U79"><span class="var type1" id="S7T8U302">plim</span>(<span class="mxinfo " id="T1:U81">2</span>)</span>)</span> ]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,92" id="srcline92"> 92</a></span><span class="line"><span class="mxinfo " id="T3:U82"><span class="var type1" id="S24T3U306">pc</span> = <span class="mxinfo " id="T3:U84">2 .^ <span class="var type1" id="S22T3U309">log2pc</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,93" id="srcline93"> 93</a></span><span class="line"><span class="mxinfo " id="T27:U86"><span class="var type1" id="S25T27U312">S</span> = <span class="mxinfo " id="T27:U88">zeros( <span class="mxinfo " id="T1:U89">length(<span class="var type1" id="S24T3U317">pc</span>)</span>, <span class="mxinfo " id="T1:U91">length(<span class="var type1" id="S3T3U320">t</span>)</span> )</span></span>; <span class="comment">% Pitch strength matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,94" id="srcline94"> 94</a></span><span class="line"><span class="comment">% Determine P2-WSs</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,95" id="srcline95"> 95</a></span><span class="line"><span class="mxinfo " id="T8:U93"><span class="var type1" id="S27T8U323">logWs</span> = <span class="mxinfo " id="T8:U95">round( <span class="mxinfo " id="T8:U96">log2( <span class="mxinfo " id="T8:U97"><span class="mxinfo " id="T1:U98"><span class="mxinfo " id="T1:U99">8</span>*<span class="var type1" id="S6T1U331">fs</span></span> ./ <span class="var type1" id="S7T8U332">plim</span></span> )</span> )</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="160,96" id="srcline96"> 96</a></span><span class="line"><span class="mxinfo " id="T24:U102"><span class="var type1" id="S29T24U335">ws</span> = <span class="mxinfo " id="T24:U104">2.^<span class="mxinfo " id="T24:U105">[ <span class="mxinfo " id="T1:U106"><span class="var type1" id="S27T8U343">logWs</span>(<span class="mxinfo " id="T1:U108">1</span>)</span>: -1: <span class="mxinfo " id="T1:U109"><span class="var type1" id="S27T8U348">logWs</span>(<span class="mxinfo " id="T1:U111">2</span>)</span> ]</span></span></span>; <span class="comment">% P2-WSs</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo " id="T24:U112"><span class="var type1" id="S30T24U352">pO</span> = <span class="mxinfo " id="T24:U114"><span class="mxinfo " id="T1:U115"><span class="mxinfo " id="T1:U116">8</span> * <span class="var type1" id="S6T1U356">fs</span></span> ./ <span class="var type1" id="S29T24U357">ws</span></span></span>; <span class="comment">% Optimal pitches for P2-WSs</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">% Determine window sizes used by each pitch candidate</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,99" id="srcline99"> 99</a></span><span class="line"><span class="mxinfo " id="T3:U119"><span class="var type1" id="S31T3U360">d</span> = <span class="mxinfo " id="T3:U121"><span class="mxinfo " id="T3:U122"><span class="mxinfo " id="T1:U123">1</span> + <span class="var type1" id="S22T3U364">log2pc</span></span> - <span class="mxinfo " id="T1:U125">log2( <span class="mxinfo " id="T1:U126"><span class="mxinfo " id="T1:U127"><span class="mxinfo " id="T1:U128">8</span>*<span class="var type1" id="S6T1U370">fs</span></span>./<span class="mxinfo " id="T1:U130"><span class="var type1" id="S29T24U372">ws</span>(<span class="mxinfo " id="T1:U132">1</span>)</span></span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,100" id="srcline100">100</a></span><span class="line"><span class="comment">% Create ERB-scale uniformly-spaced frequencies (in Hertz)</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,101" id="srcline101">101</a></span><span class="line"><span class="mxinfo " id="T3:U133"><span class="var type1" id="S32T3U376">fERBs</span> = <span class="mxinfo " id="T3:U135"><span class="fcn" id="F710N17:B378">erbs2hz</span>(<span class="mxinfo " id="T3:U136"><span class="mxinfo " id="T24:U137">[ <span class="mxinfo " id="T1:U138"><span class="fcn" id="F709N18:B385">hz2erbs</span>(<span class="mxinfo " id="T1:U139"><span class="mxinfo " id="T1:U140">min(<span class="var type1" id="S24T3U389">pc</span>)</span>/<span class="mxinfo " id="T1:U142">4</span></span>)</span>: <span class="var type1" id="S10T1U391">dERBs</span>: <span class="mxinfo " id="T1:U144"><span class="fcn" id="F709N18:B393">hz2erbs</span>(<span class="mxinfo " id="T1:U145"><span class="var type1" id="S6T1U395">fs</span>/<span class="mxinfo " id="T1:U147">2</span></span>)</span> ]</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,102" id="srcline102">102</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S36T1U399">i</span> = <span class="mxinfo " id="T1:U149">1</span> : <span class="mxinfo " id="T1:U150">length(<span class="var type1" id="S29T24U404">ws</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,103" id="srcline103">103</a></span><span class="line">    <span class="mxinfo " id="T1:U152"><span class="var type1" id="S37T1U407">dn</span> = <span class="mxinfo " id="T1:U154">max( <span class="mxinfo " id="T1:U155">1</span>, <span class="mxinfo " id="T1:U156">round( <span class="mxinfo " id="T1:U157"><span class="mxinfo " id="T1:U158"><span class="mxinfo " id="T1:U159"><span class="mxinfo " id="T1:U160">8</span>*(<span class="mxinfo " id="T1:U161"><span class="mxinfo " id="T1:U162">1</span>-<span class="var type1" id="S11T1U420">woverlap</span></span>)</span> * <span class="var type1" id="S6T1U421">fs</span></span> / <span class="mxinfo " id="T1:U165"><span class="var type1" id="S30T24U423">pO</span>(<span class="var type1" id="S36T1U424">i</span>)</span></span> )</span> )</span></span>; <span class="comment">% Hop size</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,104" id="srcline104">104</a></span><span class="line">    <span class="comment">% Zero pad signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,105" id="srcline105">105</a></span><span class="line">    <span class="mxinfo " id="T3:U168"><span class="var type1" id="S39T3U427">xzp</span> = <span class="mxinfo " id="T3:U170">[ <span class="mxinfo " id="T3:U171">zeros( <span class="mxinfo " id="T1:U172"><span class="mxinfo " id="T1:U173"><span class="var type1" id="S29T24U434">ws</span>(<span class="var type1" id="S36T1U435">i</span>)</span>/<span class="mxinfo " id="T1:U176">2</span></span>, 1 )</span>; <span class="mxinfo " id="T3:U177"><span class="var type1" id="S5T3U440">x</span>(:)</span>; <span class="mxinfo " id="T3:U179">zeros( <span class="mxinfo " id="T1:U180"><span class="var type1" id="S37T1U446">dn</span> + <span class="mxinfo " id="T1:U182"><span class="mxinfo " id="T1:U183"><span class="var type1" id="S29T24U449">ws</span>(<span class="var type1" id="S36T1U450">i</span>)</span>/<span class="mxinfo " id="T1:U186">2</span></span></span>, 1 )</span> ]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,106" id="srcline106">106</a></span><span class="line">    <span class="comment">% Compute spectrum</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,107" id="srcline107">107</a></span><span class="line">    <span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="160,108" id="srcline108">108</a></span><span class="line">        <span class="var type0" id="S40T0U462">w</span> = hanning( <span class="var type0" id="S29T0U466">ws</span>(<span class="var type0" id="S36T0U467">i</span>) ); <span class="comment">% Hann window </span></span></span>
<span class="srcline"><span class="lineno"><a href="160,109" id="srcline109">109</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,110" id="srcline110">110</a></span><span class="line">        <span class="mxinfo " id="T3:U187"><span class="var type1" id="S40T3U471">w</span> = <span class="mxinfo " id="T3:U189">zeros(<span class="mxinfo " id="T1:U190"><span class="var type1" id="S29T24U475">ws</span>(<span class="var type1" id="S36T1U476">i</span>)</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,111" id="srcline111">111</a></span><span class="line">        coder.ceval(<span class="string">'hanning'</span>,coder.ref(<span class="mxinfo " id="T3:U193"><span class="var type1" id="S40T3U488">w</span></span>),<span class="mxinfo " id="T1:U195"><span class="var type1" id="S29T24U490">ws</span>(<span class="var type1" id="S36T1U491">i</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="160,112" id="srcline112">112</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,113" id="srcline113">113</a></span><span class="line">    <span class="mxinfo " id="T1:U198"><span class="var type1" id="S42T1U494">o</span> = <span class="mxinfo " id="T1:U200">max( <span class="mxinfo " id="T1:U201">0</span>, <span class="mxinfo " id="T1:U202">round( <span class="mxinfo " id="T1:U203"><span class="mxinfo " id="T1:U204"><span class="var type1" id="S29T24U502">ws</span>(<span class="var type1" id="S36T1U503">i</span>)</span> - <span class="var type1" id="S37T1U504">dn</span></span> )</span> )</span></span>; <span class="comment">% Window overlap</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,114" id="srcline114">114</a></span><span class="line">    <span class="keyword">if</span> coder.target(<span class="string">'MATLAB'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="160,115" id="srcline115">115</a></span><span class="line">        [ <span class="var type0" id="S43T0U515">X</span>, <span class="var type0" id="S44T0U516">f</span>, <span class="var type0" id="S45T0U517">ti</span> ] = specgram( <span class="var type0" id="S39T0U520">xzp</span>, <span class="var type0" id="S29T0U522">ws</span>(<span class="var type0" id="S36T0U523">i</span>), <span class="var type0" id="S6T0U524">fs</span>, <span class="var type0" id="S40T0U525">w</span>, <span class="var type0" id="S42T0U526">o</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="160,116" id="srcline116">116</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,117" id="srcline117">117</a></span><span class="line">        <span class="mxinfo " id="T1:U208"><span class="var type1" id="S47T1U530">windowSize</span> = <span class="mxinfo " id="T1:U210"><span class="var type1" id="S29T24U532">ws</span>(<span class="var type1" id="S36T1U533">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,118" id="srcline118">118</a></span><span class="line">        <span class="mxinfo " id="T1:U213"><span class="var type1" id="S48T1U536">framestep</span> = <span class="mxinfo " id="T1:U215"><span class="var type1" id="S47T1U538">windowSize</span> - <span class="var type1" id="S42T1U539">o</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,119" id="srcline119">119</a></span><span class="line">        <span class="mxinfo " id="T1:U218"><span class="var type1" id="S49T1U542">bins</span> = <span class="mxinfo " id="T1:U220"><span class="mxinfo " id="T1:U221"><span class="var type1" id="S47T1U545">windowSize</span> / <span class="mxinfo " id="T1:U223">2</span></span> + <span class="mxinfo " id="T1:U224">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,120" id="srcline120">120</a></span><span class="line">        <span class="mxinfo " id="T1:U225"><span class="var type1" id="S50T1U550">frames</span> = <span class="mxinfo " id="T1:U227">(<span class="mxinfo " id="T1:U228"><span class="mxinfo " id="T1:U229">length(<span class="var type1" id="S39T3U556">xzp</span>)</span> - <span class="var type1" id="S42T1U557">o</span></span>) / <span class="var type1" id="S48T1U558">framestep</span></span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="160,121" id="srcline121">121</a></span><span class="line">        <span class="mxinfo " id="T62:U233"><span class="var type1" id="S43T62U561">X</span> = <span class="mxinfo " id="T62:U235">complex(<span class="mxinfo " id="T27:U236">zeros(<span class="var type1" id="S49T1U566">bins</span>,<span class="var type1" id="S50T1U567">frames</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,122" id="srcline122">122</a></span><span class="line">        <span class="mxinfo " id="T3:U239"><span class="var type1" id="S44T3U570">f</span> = <span class="mxinfo " id="T3:U241">zeros(<span class="var type1" id="S49T1U573">bins</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,123" id="srcline123">123</a></span><span class="line">        <span class="mxinfo " id="T3:U243"><span class="var type1" id="S45T3U577">ti</span> = <span class="mxinfo " id="T3:U245">zeros(<span class="var type1" id="S50T1U580">frames</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,124" id="srcline124">124</a></span><span class="line">        <span class="comment">% use argument order of newer spectrogram function, for which we</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,125" id="srcline125">125</a></span><span class="line">        <span class="comment">% have documentation</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,126" id="srcline126">126</a></span><span class="line">        coder.ceval(<span class="string">'spectrogram'</span>,coder.ref(<span class="mxinfo " id="T62:U247"><span class="var type1" id="S43T62U592">X</span></span>), coder.ref(<span class="mxinfo " id="T3:U249"><span class="var type1" id="S44T3U597">f</span></span>), coder.ref(<span class="mxinfo " id="T3:U251"><span class="var type1" id="S45T3U602">ti</span></span>), <span class="var type1" id="S39T3U603">xzp</span>, <span class="mxinfo " id="T1:U254">length(<span class="var type1" id="S39T3U606">xzp</span>)</span>, <span class="var type1" id="S40T3U607">w</span>, <span class="var type1" id="S42T1U608">o</span>, <span class="var type1" id="S47T1U609">windowSize</span>, <span class="var type1" id="S6T1U610">fs</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="160,127" id="srcline127">127</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,128" id="srcline128">128</a></span><span class="line">    <span class="comment">% Select candidates that use this window size</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,129" id="srcline129">129</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T2:U260"><span class="mxinfo " id="T1:U261">length(<span class="var type1" id="S29T24U616">ws</span>)</span> == <span class="mxinfo " id="T1:U263">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,130" id="srcline130">130</a></span><span class="line">        <span class="mxinfo " id="T27:U264"><span class="var type1" id="S52T27U620">j</span>=<span class="mxinfo " id="T24:U266"><span class="mxinfo " id="T3:U267">[(<span class="var type1" id="S24T3U625">pc</span>)]</span>'</span></span>; <span class="mxinfo " id="T27:U269"><span class="var type1" id="S53T27U628">k</span> = <span class="mxinfo " id="T21:U271">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,131" id="srcline131">131</a></span><span class="line">    <span class="keyword">elseif</span> <span class="mxinfo " id="T2:U272"><span class="var type1" id="S36T1U633">i</span> == <span class="mxinfo " id="T1:U274">length(<span class="var type1" id="S29T24U636">ws</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,132" id="srcline132">132</a></span><span class="line">        <span class="mxinfo " id="T27:U276"><span class="var type1" id="S52T27U639">j</span>=<span class="mxinfo " id="T3:U278">find(<span class="mxinfo " id="T42:U279"><span class="mxinfo " id="T3:U280"><span class="var type1" id="S31T3U644">d</span>-<span class="var type1" id="S36T1U645">i</span></span>&gt;<span class="mxinfo " id="T1:U283">-<span class="mxinfo " id="T1:U284">1</span></span></span>)</span></span>; <span class="mxinfo " id="T27:U285"><span class="var type1" id="S53T27U650">k</span>=<span class="mxinfo " id="T3:U287">find(<span class="mxinfo " id="T134:U288"><span class="mxinfo " id="T159:U289"><span class="mxinfo " id="T159:U290"><span class="var type1" id="S31T3U656">d</span>(<span class="var type1" id="S52T27U657">j</span>)</span>-<span class="var type1" id="S36T1U658">i</span></span>&lt;<span class="mxinfo " id="T1:U294">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,133" id="srcline133">133</a></span><span class="line">    <span class="keyword">elseif</span> <span class="mxinfo " id="T2:U295"><span class="var type1" id="S36T1U662">i</span>==<span class="mxinfo " id="T1:U297">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,134" id="srcline134">134</a></span><span class="line">        <span class="mxinfo " id="T27:U298"><span class="var type1" id="S52T27U666">j</span>=<span class="mxinfo " id="T3:U300">find(<span class="mxinfo " id="T42:U301"><span class="mxinfo " id="T3:U302"><span class="var type1" id="S31T3U671">d</span>-<span class="mxinfo " id="T1:U304"><span class="var type1" id="S36T1U672">i</span></span></span>&lt;<span class="mxinfo " id="T1:U306">1</span></span>)</span></span>; <span class="mxinfo " id="T27:U307"><span class="var type1" id="S53T27U676">k</span>=<span class="mxinfo " id="T3:U309">find(<span class="mxinfo " id="T134:U310"><span class="mxinfo " id="T159:U311"><span class="mxinfo " id="T159:U312"><span class="var type1" id="S31T3U682">d</span>(<span class="var type1" id="S52T27U683">j</span>)</span>-<span class="mxinfo " id="T1:U315"><span class="var type1" id="S36T1U684">i</span></span></span>&gt;<span class="mxinfo " id="T1:U317">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,135" id="srcline135">135</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,136" id="srcline136">136</a></span><span class="line">        <span class="mxinfo " id="T27:U318"><span class="var type1" id="S52T27U689">j</span>=<span class="mxinfo " id="T3:U320">find(<span class="mxinfo " id="T42:U321"><span class="mxinfo " id="T3:U322">abs(<span class="mxinfo " id="T3:U323"><span class="var type1" id="S31T3U696">d</span>-<span class="var type1" id="S36T1U697">i</span></span>)</span>&lt;<span class="mxinfo " id="T1:U326">1</span></span>)</span></span>; <span class="mxinfo " id="T27:U327"><span class="var type1" id="S53T27U701">k</span>=<span class="mxinfo " id="T27:U329">1:<span class="mxinfo " id="T1:U330">length(<span class="var type1" id="S52T27U706">j</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,137" id="srcline137">137</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,138" id="srcline138">138</a></span><span class="line">    <span class="comment">% Compute loudness at ERBs uniformly-spaced frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,139" id="srcline139">139</a></span><span class="line">    <span class="mxinfo " id="T115:U332"><span class="var type1" id="S56T115U709">found</span> = <span class="mxinfo " id="T115:U334">find( <span class="mxinfo " id="T42:U335"><span class="var type1" id="S32T3U713">fERBs</span> &gt; <span class="mxinfo " id="T1:U337"><span class="mxinfo " id="T1:U338"><span class="var type1" id="S24T3U716">pc</span>(<span class="mxinfo " id="T1:U340"><span class="var type1" id="S52T27U718">j</span>(<span class="mxinfo " id="T1:U342">1</span>)</span>)</span>/<span class="mxinfo " id="T1:U343">4</span></span></span>, 1, <span class="string">'first'</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,140" id="srcline140">140</a></span><span class="line">    <span class="mxinfo " id="T3:U344"><span class="var type1" id="S32T3U725">fERBs</span> = <span class="mxinfo " id="T3:U346"><span class="var type1" id="S32T3U727">fERBs</span>( <span class="mxinfo " id="T1:U348"><span class="var type1" id="S56T115U730">found</span>(<span class="mxinfo " id="T1:U350">1</span>)</span> : <span class="mxinfo " id="T1:U351">end</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,141" id="srcline141">141</a></span><span class="line">    <span class="mxinfo " id="T27:U352"><span class="var type1" id="S58T27U736">L</span> = <span class="mxinfo " id="T27:U354">sqrt( <span class="mxinfo " id="T27:U355">max( 0, <span class="mxinfo " id="T27:U356">interp1( <span class="var type1" id="S44T3U744">f</span>, <span class="mxinfo " id="T27:U358">abs(<span class="var type1" id="S43T62U747">X</span>)</span>, <span class="var type1" id="S32T3U748">fERBs</span>, <span class="string">'spline'</span>, 0)</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,142" id="srcline142">142</a></span><span class="line">    <span class="comment">% Compute pitch strength</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,143" id="srcline143">143</a></span><span class="line">    <span class="mxinfo " id="T27:U361"><span class="var type1" id="S61T27U753">Si</span> = <span class="mxinfo " id="T27:U363"><span class="fcn" id="F988N19:B755">pitchStrengthAllCandidates</span>( <span class="var type1" id="S32T3U756">fERBs</span>, <span class="var type1" id="S58T27U757">L</span>, <span class="mxinfo " id="T27:U366"><span class="var type1" id="S24T3U759">pc</span>(<span class="var type1" id="S52T27U760">j</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,144" id="srcline144">144</a></span><span class="line">    <span class="comment">% Interpolate pitch strength at desired times</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,145" id="srcline145">145</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T2:U369"><span class="mxinfo " id="T1:U370">size(<span class="var type1" id="S61T27U766">Si</span>,2)</span> &gt; <span class="mxinfo " id="T1:U372">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,146" id="srcline146">146</a></span><span class="line">        <span class="mxinfo " id="T92:U373"><span class="extrinsicFcn" id="F1511N22:B770">warning</span> <span class="mxinfo " id="T6:U374"><span class="string">off</span></span> <span class="mxinfo " id="T147:U375"><span class="string">MATLAB:interp1:NaNinY</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,147" id="srcline147">147</a></span><span class="line">        <span class="mxinfo " id="T27:U376"><span class="var type1" id="S61T27U775">Si</span> = <span class="mxinfo " id="T27:U378"><span class="mxinfo " id="T27:U379">interp1( <span class="var type1" id="S45T3U779">ti</span>, <span class="mxinfo " id="T27:U381"><span class="var type1" id="S61T27U781">Si</span>'</span>, <span class="var type1" id="S3T3U782">t</span>, <span class="string">'linear'</span>, NaN )</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,148" id="srcline148">148</a></span><span class="line">        <span class="mxinfo " id="T92:U384"><span class="extrinsicFcn" id="F1512N22:B787">warning</span> <span class="mxinfo " id="T31:U385"><span class="string">on</span></span> <span class="mxinfo " id="T147:U386"><span class="string">MATLAB:interp1:NaNinY</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,149" id="srcline149">149</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,150" id="srcline150">150</a></span><span class="line">        <span class="mxinfo " id="T27:U387"><span class="var type1" id="S61T27U793">Si</span> = <span class="mxinfo " id="T27:U389">repmat( NaN, <span class="mxinfo " id="T1:U390">length(<span class="var type1" id="S61T27U800">Si</span>)</span>, <span class="mxinfo " id="T1:U392">length(<span class="var type1" id="S3T3U803">t</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,151" id="srcline151">151</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,152" id="srcline152">152</a></span><span class="line">    <span class="comment">% Add pitch strength to combination</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,153" id="srcline153">153</a></span><span class="line">    <span class="mxinfo " id="T27:U394"><span class="var type1" id="S67T27U806">lambda</span> = <span class="mxinfo " id="T27:U396"><span class="mxinfo " id="T27:U397"><span class="var type1" id="S31T3U809">d</span>( <span class="mxinfo " id="T27:U399"><span class="var type1" id="S52T27U811">j</span>(<span class="var type1" id="S53T27U812">k</span>)</span> )</span> - <span class="var type1" id="S36T1U813">i</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,154" id="srcline154">154</a></span><span class="line">    <span class="mxinfo " id="T27:U403"><span class="var type1" id="S68T27U816">mu</span> = <span class="mxinfo " id="T27:U405">ones( <span class="mxinfo " id="T8:U406">size(<span class="var type1" id="S52T27U821">j</span>)</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,155" id="srcline155">155</a></span><span class="line">    <span class="mxinfo " id="T27:U408"><span class="mxinfo " id="T27:U409"><span class="var type1" id="S68T27U825">mu</span>(<span class="var type1" id="S53T27U826">k</span>)</span> = <span class="mxinfo " id="T27:U412"><span class="mxinfo " id="T1:U413">1</span> - <span class="mxinfo " id="T27:U414">abs( <span class="var type1" id="S67T27U831">lambda</span> )</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,156" id="srcline156">156</a></span><span class="line">    <span class="mxinfo " id="T27:U416"><span class="mxinfo " id="T27:U417"><span class="var type1" id="S25T27U835">S</span>(<span class="var type1" id="S52T27U836">j</span>,:)</span> = <span class="mxinfo " id="T27:U420"><span class="mxinfo " id="T27:U421"><span class="var type1" id="S25T27U840">S</span>(<span class="var type1" id="S52T27U841">j</span>,:)</span> + <span class="mxinfo " id="T27:U424"><span class="mxinfo " id="T27:U425">repmat(<span class="var type1" id="S68T27U846">mu</span>,1,<span class="mxinfo " id="T1:U427">size(<span class="var type1" id="S61T27U850">Si</span>,2)</span>)</span> .* <span class="var type1" id="S61T27U852">Si</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,157" id="srcline157">157</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,158" id="srcline158">158</a></span><span class="line"><span class="comment">% Fine tune pitch using parabolic interpolation</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo " id="T3:U430"><span class="var type1" id="S2T3U855">p</span> = <span class="mxinfo " id="T3:U432">repmat( NaN, <span class="mxinfo " id="T1:U433">size(<span class="var type1" id="S25T27U862">S</span>,2)</span>, 1 )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,160" id="srcline160">160</a></span><span class="line"><span class="mxinfo " id="T3:U435"><span class="var type1" id="S4T3U867">s</span> = <span class="mxinfo " id="T3:U437">repmat( NaN, <span class="mxinfo " id="T1:U438">size(<span class="var type1" id="S25T27U874">S</span>,2)</span>, 1 )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,161" id="srcline161">161</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S52T1U879">j</span> = <span class="mxinfo " id="T1:U441">1</span> : <span class="mxinfo " id="T1:U442">size(<span class="var type1" id="S25T27U884">S</span>,2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,162" id="srcline162">162</a></span><span class="line">    [ <span class="mxinfo " id="T1:U444"><span class="var type1" id="S4T3U890">s</span>(<span class="var type1" id="S52T1U891">j</span>)</span>, <span class="mxinfo " id="T1:U447"><span class="var type1" id="S36T1U892">i</span></span> ] = max( <span class="mxinfo " id="T3:U449"><span class="var type1" id="S25T27U896">S</span>(:,<span class="var type1" id="S52T1U898">j</span>)</span>, [], 1 );</span></span>
<span class="srcline"><span class="lineno"><a href="160,163" id="srcline163">163</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T2:U452"><span class="mxinfo " id="T1:U453"><span class="var type1" id="S4T3U906">s</span>(<span class="var type1" id="S52T1U907">j</span>)</span> &lt; <span class="var type1" id="S12T1U908">sTHR</span></span>, <span class="keyword">continue</span>, <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,164" id="srcline164">164</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T2:U457"><span class="var type1" id="S36T1U914">i</span> == <span class="mxinfo " id="T1:U459">1</span></span> || <span class="mxinfo " id="T2:U460"><span class="var type1" id="S36T1U917">i</span> == <span class="mxinfo " id="T1:U462">length(<span class="var type1" id="S24T3U920">pc</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,165" id="srcline165">165</a></span><span class="line">        <span class="mxinfo " id="T1:U464"><span class="mxinfo " id="T1:U465"><span class="var type1" id="S2T3U924">p</span>(<span class="var type1" id="S52T1U925">j</span>)</span> = <span class="mxinfo " id="T1:U468"><span class="var type1" id="S24T3U927">pc</span>(<span class="var type1" id="S36T1U928">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,166" id="srcline166">166</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,167" id="srcline167">167</a></span><span class="line">        <span class="mxinfo " id="T24:U471"><span class="var type1" id="S70T24U932">I</span> = <span class="mxinfo " id="T24:U473"><span class="mxinfo " id="T1:U474"><span class="var type1" id="S36T1U935">i</span>-<span class="mxinfo " id="T1:U476">1</span></span> : <span class="mxinfo " id="T1:U477"><span class="var type1" id="S36T1U938">i</span>+<span class="mxinfo " id="T1:U479">1</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,168" id="srcline168">168</a></span><span class="line">        <span class="mxinfo " id="T3:U480"><span class="var type1" id="S71T3U942">tc</span> = <span class="mxinfo " id="T3:U482"><span class="mxinfo " id="T1:U483">1</span> ./ <span class="mxinfo " id="T3:U484"><span class="var type1" id="S24T3U946">pc</span>(<span class="var type1" id="S70T24U947">I</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,169" id="srcline169">169</a></span><span class="line">        <span class="mxinfo " id="T3:U487"><span class="var type1" id="S72T3U950">ntc</span> = <span class="mxinfo " id="T3:U489"><span class="mxinfo " id="T3:U490">( <span class="mxinfo " id="T3:U491"><span class="mxinfo " id="T3:U492"><span class="var type1" id="S71T3U956">tc</span>/<span class="mxinfo " id="T1:U494"><span class="var type1" id="S71T3U958">tc</span>(<span class="mxinfo " id="T1:U496">2</span>)</span></span> - <span class="mxinfo " id="T1:U497">1</span></span> ) * <span class="mxinfo " id="T1:U498">2</span></span>*<span class="mxinfo " id="T1:U499">pi</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,170" id="srcline170">170</a></span><span class="line">        <span class="mxinfo " id="T49:U500"><span class="var type1" id="S74T49U966">c</span> = <span class="mxinfo " id="T49:U502">polyfit( <span class="var type1" id="S72T3U969">ntc</span>, <span class="mxinfo " id="T3:U504"><span class="var type1" id="S25T27U971">S</span>(<span class="var type1" id="S70T24U972">I</span>,<span class="var type1" id="S52T1U973">j</span>)</span>, 2 )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,171" id="srcline171">171</a></span><span class="line">        <span class="mxinfo " id="T24:U508"><span class="var type1" id="S76T24U977">ftc</span> = <span class="mxinfo " id="T24:U510"><span class="mxinfo " id="T1:U511">1</span> ./ <span class="mxinfo " id="T24:U512">2.^<span class="mxinfo " id="T24:U513">[ <span class="mxinfo " id="T1:U514">log2(<span class="mxinfo " id="T1:U515"><span class="var type1" id="S24T3U989">pc</span>(<span class="mxinfo " id="T1:U517"><span class="var type1" id="S70T24U991">I</span>(<span class="mxinfo " id="T1:U519">1</span>)</span>)</span>)</span>: 1/12/100: <span class="mxinfo " id="T1:U520">log2(<span class="mxinfo " id="T1:U521"><span class="var type1" id="S24T3U1001">pc</span>(<span class="mxinfo " id="T1:U523"><span class="var type1" id="S70T24U1003">I</span>(<span class="mxinfo " id="T1:U525">3</span>)</span>)</span>)</span> ]</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,172" id="srcline172">172</a></span><span class="line">        <span class="mxinfo " id="T24:U526"><span class="var type1" id="S77T24U1007">nftc</span> = <span class="mxinfo " id="T24:U528"><span class="mxinfo " id="T24:U529">( <span class="mxinfo " id="T24:U530"><span class="mxinfo " id="T24:U531"><span class="var type1" id="S76T24U1013">ftc</span>/<span class="mxinfo " id="T1:U533"><span class="var type1" id="S71T3U1015">tc</span>(<span class="mxinfo " id="T1:U535">2</span>)</span></span> - <span class="mxinfo " id="T1:U536">1</span></span> ) * <span class="mxinfo " id="T1:U537">2</span></span>*<span class="mxinfo " id="T1:U538">pi</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,173" id="srcline173">173</a></span><span class="line">        [<span class="mxinfo " id="T1:U539"><span class="var type1" id="S4T3U1025">s</span>(<span class="var type1" id="S52T1U1026">j</span>)</span> <span class="mxinfo " id="T1:U542"><span class="var type1" id="S53T1U1027">k</span></span>] = max( <span class="mxinfo " id="T24:U544">polyval( <span class="var type1" id="S74T49U1032">c</span>, <span class="var type1" id="S77T24U1033">nftc</span> )</span> );</span></span>
<span class="srcline"><span class="lineno"><a href="160,174" id="srcline174">174</a></span><span class="line">        <span class="mxinfo " id="T1:U547"><span class="mxinfo " id="T1:U548"><span class="var type1" id="S2T3U1037">p</span>(<span class="var type1" id="S52T1U1038">j</span>)</span> = <span class="mxinfo " id="T1:U551"><span class="mxinfo " id="T1:U552">2</span> ^ ( <span class="mxinfo " id="T1:U553"><span class="mxinfo " id="T1:U554">log2(<span class="mxinfo " id="T1:U555"><span class="var type1" id="S24T3U1046">pc</span>(<span class="mxinfo " id="T1:U557"><span class="var type1" id="S70T24U1048">I</span>(<span class="mxinfo " id="T1:U559">1</span>)</span>)</span>)</span> + <span class="mxinfo " id="T1:U560"><span class="mxinfo " id="T1:U561">(<span class="mxinfo " id="T1:U562"><span class="var type1" id="S53T1U1054">k</span>-<span class="mxinfo " id="T1:U564">1</span></span>)/<span class="mxinfo " id="T1:U565">12</span></span>/<span class="mxinfo " id="T1:U566">100</span></span></span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,175" id="srcline175">175</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,176" id="srcline176">176</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="160,177" id="srcline177">177</a></span><span class="line"></span></span>
</pre>
